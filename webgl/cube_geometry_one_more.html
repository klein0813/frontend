<!DOCTYPE html>
  <head>
    <title>Cube Geometry One More</title>
  </head>
  <body>
    <canvas id="webgl" width="500" height="500" style="background-color: grey;"></canvas>
    <script>
      const canvas = document.getElementById('webgl');
      const gl = canvas.getContext('webgl');
      const vertexShaderSource = `
        varying vec4 v_color;
        attribute vec4 apos;
        attribute vec4 a_color;
        attribute vec4 a_normal;
        uniform mat4 u_tx;
        uniform mat4 u_rx;
        uniform mat4 u_ry;
        uniform vec3 u_lightPosition;
        uniform vec3 u_lightColor;

        void main () {
          gl_Position =  u_rx * u_ry * u_tx * apos;
          vec3 normal = normalize((u_rx * u_ry * u_tx * a_normal).xyz);
          vec3 lightDirection = normalize(vec3(gl_Position) - u_lightPosition);
          float dotcos = max(dot(normal, lightDirection), 0.0);
          vec3 reflectdLightColor = u_lightColor * a_color.rgb * dotcos;
          v_color = vec4(reflectdLightColor, a_color.a);
        }
      `;
      const fragShaderSource = `
        precision lowp float;
        varying vec4 v_color;
        void main () {
          gl_FragColor = v_color;
        }
      `;
      const aposData = new Float32Array([
        0.5,0.5,0.5, -.5,0.5,0.5, -.5,-.5,0.5, 0.5,0.5,0.5, -.5,-.5,0.5, 0.5,-.5,0.5, // 正面
        0.5,0.5,-.5, -.5,0.5,-.5, -.5,-.5,-.5, 0.5,0.5,-.5, -.5,-.5,-.5, 0.5,-.5,-.5, // 后面
        0.5,0.5,0.5, -.5,0.5,0.5, -.5,0.5,-.5, 0.5,0.5,0.5, -.5,0.5,-.5, 0.5,0.5,-.5, // 上面
        0.5,-.5,0.5, -.5,-.5,0.5, -.5,-.5,-.5, 0.5,-.5,0.5, -.5,-.5,-.5, 0.5,-.5,-.5, // 下面
        0.5,0.5,0.5, 0.5,0.5,-.5, 0.5,-.5,-.5, 0.5,0.5,0.5, 0.5,-.5,-.5, 0.5,-.5,0.5  // 右面 
        -.5,0.5,0.5, -.5,0.5,-.5, -.5,-.5,-.5, -.5,0.5,0.5, -.5,-.5,-.5, -.5,-.5,0.5, // 左面
      ]);
      const normalData = new Float32Array([
        0,0,1, 0,0,1, 0,0,1, 0,0,1, 0,0,1, 0,0,1,         // 正面法向量
        0,0,-1, 0,0,-1, 0,0,-1, 0,0,-1, 0,0,-1, 0,0,-1, // 后面法向量
        0,1,0, 0,1,0, 0,1,0, 0,1,0, 0,1,0, 0,1,0,       // 上面法向量
        0,-1,0, 0,-1,0, 0,-1,0, 0,-1,0, 0,-1,0, 0,-1,0, // 下面法向量
        1,0,0, 1,0,0, 1,0,0, 1,0,0, 1,0,0, 1,0,0,       // 右面法向量
        -1,0,0, -1,0,0, -1,0,0, -1,0,0, -1,0,0, -1,0,0 // 左面法向量
      ]);
      const colorData = new Float32Array(108).fill(1.0);
      const vertexShader = gl.createShader(gl.VERTEX_SHADER);
      const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(vertexShader, vertexShaderSource);
      gl.shaderSource(fragmentShader, fragShaderSource);
      gl.compileShader(vertexShader);
      gl.compileShader(fragmentShader);
      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      gl.useProgram(program);

      const aposBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, aposBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, aposData, gl.STATIC_DRAW);
      const aposAttrib = gl.getAttribLocation(program, 'apos');
      gl.vertexAttribPointer(aposAttrib, 3, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(aposAttrib);
      const colorBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, colorData, gl.STATIC_DRAW);
      const colorAttrib = gl.getAttribLocation(program, 'a_color');
      gl.vertexAttribPointer(colorAttrib, 3, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(colorAttrib);
      const normalBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, normalData, gl.STATIC_DRAW);
      const normalAttrib = gl.getAttribLocation(program, 'a_normal');
      gl.vertexAttribPointer(normalAttrib, 3, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(normalAttrib);
      const txUniform = gl.getUniformLocation(program, 'u_tx');
      gl.uniformMatrix4fv(txUniform, false, new Float32Array([
        1, 0, 0, 0,
        0, 1, 0, 0,
        0, 0, 1, 0,
        0, 0, 0, 1
      ]));
      const rxUniform = gl.getUniformLocation(program, 'u_rx');
      const sin30 = Math.sin(Math.PI / 6);
      const cos30 = Math.cos(Math.PI / 6);
      gl.uniformMatrix4fv(rxUniform, false, new Float32Array([
        1, 0, 0, 0,
        0, 1, 0, 0,
        0, 0, 1, 0,
        0, 0, 0, 1
      ]));
      const ryUniform = gl.getUniformLocation(program, 'u_ry');
      gl.uniformMatrix4fv(ryUniform, false, new Float32Array([
        1, 0, 0, 0,
        0, 1, 0, 0,
        0, 0, 1, 0,
        0, 0, 0, 1
      ]));
      const lightColorUniform = gl.getUniformLocation(program, 'u_lightColor');
      gl.uniform3f(lightColorUniform, 1.0, 1.0, 1.0);
      const lightPositionUniform = gl.getUniformLocation(program, 'u_lightPosition');
      gl.uniform3f(lightPositionUniform, 0, 0, -1);

      gl.enable(gl.DEPTH_TEST);
      gl.drawArrays(gl.TRIANGLES, 0, 6);
    </script>
  </body>
</html>
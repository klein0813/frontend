<!DOCTYPE html>
  <head>
    <title>Texture Image</title>
    <script src="../libs/baidu_tongji.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="500" height="500" style="background-color: grey;"></canvas>
    <script>
      const canvas = document.getElementById('canvas');
      const gl = canvas.getContext('webgl');
      const vertexShaderSource = `
        varying vec2 v_texCoord;
        attribute vec4 apos;
        attribute vec2 a_texCoord;
        void main () {
          gl_Position = apos;
          v_texCoord = a_texCoord;
        }
      `;
      const fragShaderSource = `
        precision highp float;
        varying vec2 v_texCoord;
        uniform sampler2D u_sampler;
        void main () {
          vec4 color = texture2D(u_sampler, v_texCoord);
          if (color.r > 0.9 && color.g > 0.9 && color.b > 0.9) {
            discard;
          } else {
            gl_FragColor = texture2D(u_sampler, v_texCoord);
          }
        }
      `;
      const vertexShader = gl.createShader(gl.VERTEX_SHADER);
      const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(vertexShader, vertexShaderSource);
      gl.shaderSource(fragmentShader, fragShaderSource);
      gl.compileShader(vertexShader);
      gl.compileShader(fragmentShader);
      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      gl.useProgram(program);
      const aposAttrib = gl.getAttribLocation(program, 'apos');
      const aposBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, aposBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ -.5, 0.5, 0.5, 0.5, -.5, -.5, 0.5, -.5 ]), gl.STATIC_DRAW);
      gl.vertexAttribPointer(aposAttrib, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(aposAttrib);
      const aTexCoordAttrib = gl.getAttribLocation(program, 'a_texCoord');
      const aTexCoordBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, aTexCoordBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ 0, 1, 1, 1, 0, 0, 1, 0 ]), gl.STATIC_DRAW);
      gl.vertexAttribPointer(aTexCoordAttrib, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(aTexCoordAttrib);

      const image = new Image();
      image.onload = loadTexture;
      image.src = './texture.jpg';

      function loadTexture () {
        const textureBuffer = gl.createTexture();
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, textureBuffer);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image);
        gl.uniform1i(gl.getUniformLocation(program, 'u_sampler'), 0);
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      }
    </script>
  </body>
</html>
